package mears.trace.stats_application.controllers;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;

import mears.trace.stats_application.models.Fighter;
import mears.trace.stats_application.models.User;
import mears.trace.stats_application.repositories.FighterRepository;

@Controller
public class TableController {
	
	@Autowired
	FighterRepository fRepo;
	
	@GetMapping("/tableView")
	public String showTablePage(Model model, HttpSession sesh) {
		model.addAttribute("allFighters", fRepo.showFighters());
		if ( (Integer) sesh.getAttribute("tableCounter") == 0 ) {
			sesh.setAttribute("tableCounter", 0);
		}		
		
		List<Fighter> tableList = new ArrayList<Fighter>();
		sesh.setAttribute("tableList", tableList);
		
		return "TableView";
	}
	
	@PostMapping("/addToTable")
	public String addToTable(@RequestParam("Add_ Fighter") Integer fId,
								HttpSession sesh,
								Model model) {
		Integer count = (Integer) sesh.getAttribute("tableCounter");
		if( count > 9) {
			return "redirect:/tableView";
		}
		
		@SuppressWarnings("unchecked")
		List<Fighter> tabList = (List<Fighter>) sesh.getAttribute("tableList");
		
		
		
		uRepo.addToFavorites(u, fId);
		u.setCount(u.getCount() + 1);		
		sesh.setAttribute("loggedUser", u);		
		
		return "redirect:/tableView";
	}
	
	
	
	
}
